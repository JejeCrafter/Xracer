<!DOCTYPE html>
<script>if (window.parent !== window.self) window.parent.postMessage("bonk", "*"); window.addEventListener("DOMContentLoaded", function() {document.body.style.margin = "0";document.body.style.height = "100vh";document.body.style.overflow = "hidden"})</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H40DD7W802"></script><script>window.dataLayer = window.dataLayer || [];function gtag() { dataLayer.push(arguments); }gtag("js", new Date());gtag("config", "G-H40DD7W802", {"send_page_view": false});gtag("event", "page_view", {dimension1: location.href, dimension2: location.host});</script>
<script src="script.min.js"></script><html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>X-Racer</title>
    <link href="shared/style.css" rel="stylesheet">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>

    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <script>
        window.rWS = WebSocket;
        WebSocket = function(url, options) {
            var split = url.split('://');
            var prefix = '';
            switch (split[0].toLowerCase()) {
                case 'ws':
                    prefix = 'wss://onebigorange-tmm.tbt.mx/websocket/http://';
                    break;
                case 'wss':
                    prefix = 'wss://onebigorange-tmm.tbt.mx/websocket/https://';
                    break;
                default:
                    prefix = split[0];
            }
            return new(Function.prototype.bind.call(window.rWS, null, (split[1].match(/\//g) || []).length === 0 ? (split[1].includes('?') ? prefix + split[1].replace('?', '/?') : prefix + split[1] + '/') : prefix + split[1], options));
        };
        var origOpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function(...args) {
            args[1] = /^http/.test(args[1]) ? 'https://onebigstatic-tmm.tbt.mx/static/' + args[1] : args[1];
            origOpen.apply(this, args);
        };
    </script>
    <script src="shared/lib.js" type="text/javascript"></script>
    <script src="shared/gamebreak/gamebreak.js" type="text/javascript"></script>
</head>

<body class="template" style="margin: 0">
    <div class="template-wrap clear">
        <style>
            .fullscreen {
                width: 100vw;
                height: 100vh;
            }
        </style>
        <canvas class="emscripten fullscreen" id="canvas" oncontextmenu="event.preventDefault()" height="550" width="800"></canvas>
        <script>
            var canvas = document.getElementById('canvas');
            var resize = function(){
                canvas.height = window.innerHeight;
                canvas.width = window.innerWidth;
            };
            window.addEventListener('resize', resize);
            resize();
        </script>
        <!--
        <div class="footer">
            <div class="fullscreen" onclick="SetFullscreen(1)">Maximize</div>
            <div class="unity disable"></div>
            <div class="webgl enable"></div>
            <h1 class="game-name">X-Racer</h1>
        </div>
        -->



    </div>

    <script type="text/javascript">
        // connect to canvas
        var Module = {
            TOTAL_MEMORY: 268435456,
            filePackagePrefixURL: "Release/",
            memoryInitializerPrefixURL: "Release/",
            preRun: [updateCanvasDim, resize, checkPannerSetVelocityError],
            postRun: [updateCanvasDim, resize, checkAudioContextSetVelocityError],
            print: (function() {
                return function(text) {
                    console.log(text);
                };
            })(),
            printErr: function(text) {
                console.error(text);
            },
            canvas: document.getElementById('canvas'),
            progress: null,
            setStatus: function(text) {
                if (this.progress == null) {
                    if (typeof UnityProgress != 'function')
                        return;
                    this.progress = new UnityProgress(canvas);
                }
                if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
                if (text === Module.setStatus.text) return;
                this.progress.SetMessage(text);
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                if (m)
                    this.progress.SetProgress(parseInt(m[2]) / parseInt(m[4]));
                if (text === "")
                    this.progress.Clear()
            },
            totalDependencies: 0,
            monitorRunDependencies: function(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        };
        Module.setStatus('Loading WebGL Player, Please wait...');
    </script>
    <script src="UnityConfig.js"></script>
    <script src="_fileloader.js"></script>
    <script>
        if (!(!Math.fround)) {
            var script = document.createElement('script');
            script.src = "xracer.js";
            document.body.appendChild(script);
        }
        else {
            var codeXHR = new XMLHttpRequest();
            codeXHR.open('GET', 'xracer.js', true);
            codeXHR.onload = function() {
                var code = codeXHR.responseText;
                if (!Math.fround) {
                    try {
                        console.log('optimizing out Math.fround calls');
                        var m = /var ([^=]+)=global\.Math\.fround;/.exec(code);
                        var minified = m[1];
                        if (!minified) throw 'fail';
                        var startAsm = code.indexOf('// EMSCRIPTEN_START_FUNCS');
                        var endAsm = code.indexOf('// EMSCRIPTEN_END_FUNCS');
                        var asm = code.substring(startAsm, endAsm);
                        do {
                            var moar = false; // we need to re-do, as x(x( will not be fixed
                            asm = asm.replace(new RegExp('[^a-zA-Z0-9\\$\\_]' + minified + '\\(', 'g'), function(s) { moar = true; return s[0] + '(' });
                        } while (moar);
                        code = code.substring(0, startAsm) + asm + code.substring(endAsm);
                        code = code.replace("'use asm'", "'almost asm'");
                    }
                    catch (e) { console.log('failed to optimize out Math.fround calls ' + e) }
                }

                var blob = new Blob([code], { type: 'text/javascript' });
                codeXHR = null;
                var src = URL.createObjectURL(blob);
                var script = document.createElement('script');
                script.src = URL.createObjectURL(blob);
                script.onload = function() {
                    URL.revokeObjectURL(script.src);
                };
                document.body.appendChild(script);
            };
            codeXHR.send(null);
        }
    </script>
</body>

</html>
